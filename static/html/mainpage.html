<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crawler</title>
  <link rel="stylesheet" type="text/css" href="/css/semantic/semantic.min.css">
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script src="/css/semantic/semantic.min.js"></script>
</head>

<body>
  <div class="ui container">
    <h2 class="ui icon header center aligned">
      <i class="search icon yellow circular"></i>
      <div class="ui header">News Crawler</div>
    </h2>
    <div class="ui grid centered two column">
      <div class="row column">
        <select class="ui dropdown" id="news-selector">
        </select>
        <div class="ui yellow left pointing label">
          <i class="search icon"></i>
          <div class="detail">Fetcher list</div>
        </div>
      </div>
      <div class="row column">
        <div class="ui massive action icon input">
          <input type="text" placeholder="Keyword  關鍵詞" id='keyword'>
          <button class="ui icon button teal" id="execute">
            <i class="arrow right icon"></i>
          </button>
        </div>
      </div>
      <div class="row two column">
        <div class="ui right labeled input">
          <i class="ui green horizontal label"">delay</i>
          <input type=" text" placeholder="Delay" value="20" id="delay">
            <div class="ui basic label">
              ms
            </div>
        </div>

        <div class="ui right labeled input">
          <i class="ui blue horizontal label"">PageLoadDelay</i>
            <input type=" text" placeholder="Per page load delay" value="2000" id="pageLoadDelay">
            <div class="ui basic label">
              ms
            </div>
        </div>

      </div>
      <div class="row column">
        <div class="ui icon message">
          <i class="inbox icon"></i>
          <div class="content">
            <div class="header">
              Where the results saved?
            </div>
            <div class="header">
              結果在哪裏
            </div>
            <p>Results are under <code>output</code> Folder!</p>
            <p>結果位於<code>output</code>目錄下！</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    let fetcher = "";
    function getNewsList() {
      let ret;
      $.ajax({ url: '/function/listAllNews', async: false }).done(function (data) { ret = data; })
      return !ret ? [] : ret;
    }
    function fillNewsOption() {
      let list = getNewsList();
      let options = [{ name: 'news_All 全部新聞', value: 'all', selected: true }];
      list.forEach(function (value, _index, _array) {
        options.push({ name: value, value: value });
      })
      $('#news-selector').dropdown({ values: options });
    }
    $(document).ready(function () {
      fillNewsOption();
      $('#news-selector').dropdown('setting', 'onChange', function (value) {
        fetcher = value;
      });
    }
    );
    $('#execute').on('click', function (event) {
      let keyword = $('#keyword').val();
      let delay = $('#delay').val();
      let pageLoadDelay = $('#pageLoadDelay').val();
      window.location.replace(window.location.href + "dispatch" + "?keyword=" + keyword + "&delay=" + delay + "&pageLoadDelay=" + pageLoadDelay + "&fetcher=" + fetcher);
    })
  </script>
</body>

</html>